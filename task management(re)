// ê³¼ì œ í•œ ì¤„ì„ ë¶„ì„í•˜ëŠ” í•¨ìˆ˜
function parseAssignment(line) {
  const lower = line.toLowerCase();
  const majorKeywords = ["ì „ê³µ", "ai", "ì¸ê³µì§€ëŠ¥", "íŒŒì´ì¬"];
  const isMajor = majorKeywords.some(k => lower.includes(k));

  let type = "ê¸°íƒ€";
  let estimatedTime = 2;

  if (lower.includes("ì½”ë”©") || lower.includes("êµ¬í˜„")) {
    type = "ì½”ë”©"; estimatedTime = 5;
  } else if (lower.includes("ë ˆí¬íŠ¸") || lower.includes("ë³´ê³ ì„œ")) {
    type = "ë³´ê³ ì„œ"; estimatedTime = 3;
  } else if (lower.includes("ì˜ìƒ") || lower.includes("ì´¬ì˜")) {
    type = "ì˜ìƒ ì œì‘"; estimatedTime = 15;
  } else if (lower.includes("ppt") || lower.includes("ë°œí‘œ")) {
    type = "PPT"; estimatedTime = 4;
  } else if (lower.includes("ëŒ€ë³¸") || lower.includes("ì‘ì„±")) {
    type = "ëŒ€ë³¸"; estimatedTime = 3;
  } else if (lower.includes("ë¬¸ì œí’€ì´") || lower.includes("ë¬¸ì œ")) {
    type = "ë¬¸ì œí’€ì´"; estimatedTime = 2;
  }

  const deadlineMatch = line.match(/(\d{1,2})ì›”\s?(\d{1,2})ì¼/);
  let deadline = null;
  if (deadlineMatch) {
    const month = deadlineMatch[1].padStart(2, '0');
    const day = deadlineMatch[2].padStart(2, '0');
    deadline = `2025-${month}-${day}`;
  }

  const assignmentName = line.split(/\/|ì „ê³µ|êµì–‘|\d{1,2}ì›”\s?\d{1,2}ì¼/)[0].trim();

  return {
    ê³¼ì œëª…: assignmentName,
    ê³¼ì œìœ í˜•: type,
    ì†Œìš”ì‹œê°„: estimatedTime,
    ì „ê³µìœ ë¬´: isMajor ? "âœ…" : "",
    ì „ê³µê³„ì‚°ìš©: isMajor,
    ë§ˆê°ê¸°í•œ: deadline
  };
}

// main
const lines = textInput3.value.split('\n').filter(line => line.trim() !== '');
if (!lines.length) {
  utils.showNotification({
    title: "âŒ ì…ë ¥ ì˜¤ë¥˜",
    description: "í•œ ì¤„ ì´ìƒì˜ ê³¼ì œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.",
    notificationType: "error"
  });
  return;
}

const today = new Date();

const parsed = lines.map(parseAssignment).map(task => {
  const due = new Date(task.ë§ˆê°ê¸°í•œ);
  const daysLeft = Math.max(1, (due - today) / (1000 * 60 * 60 * 24));
  const deadlineScore = 10 / daysLeft;
  const majorScore = task.ì „ê³µê³„ì‚°ìš© ? 3 : 0;
  const timeScore = task.ì†Œìš”ì‹œê°„ * 0.5;

  const priority = Math.round((deadlineScore + majorScore + timeScore) * 10) / 10;

  return {
    ê³¼ì œëª…: task.ê³¼ì œëª…,
    ê³¼ì œìœ í˜•: task.ê³¼ì œìœ í˜•,
    ì†Œìš”ì‹œê°„: task.ì†Œìš”ì‹œê°„,
    ì „ê³µìœ ë¬´: task.ì „ê³µìœ ë¬´,
    ë§ˆê°ê¸°í•œ: task.ë§ˆê°ê¸°í•œ,
    ìš°ì„ ìˆœìœ„: priority
  };
});

// ìš°ì„ ìˆœìœ„ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬
parsed.sort((a, b) => b.ìš°ì„ ìˆœìœ„ - a.ìš°ì„ ìˆœìœ„);

// ğŸ” Tableë¡œ return (setData ì•ˆ ì”€!)
console.log("ğŸ” ë¶„ì„ ì™„ë£Œ ê³¼ì œ ëª©ë¡", parsed);
return parsed;
